<div ng-controller="RequestsController as request">
	<div class="row content" ng-controller="VersionsController as versions" ng-init="request.initDetailForEdit()">
		<div class="column no-padding" ng-controller="AuthenticationsController as auths">
			<div class="column with-shadow">
				<h4>{{request.formData.name}}
					<small>({{request.formData.httpMethod}} {{request.formData.url}})</small>
				</h4>

				<ul class="tabs" data-tabs id="request-editor">
					<li class="tabs-title is-active"><a href="#basic-info" aria-selected="true">Basic information</a></li>
					<li class="tabs-title" ng-show="request.formData.httpMethod != 'GET'">
						<a href="#request-parameters">{{request.formData.httpMethod}} parameters</a>
					</li>
					<li class="tabs-title"><a href="#headers">Headers</a></li>
				</ul>
				<div class="tabs-content" data-tabs-content="request-editor">
					<div class="tabs-panel is-active" id="basic-info">
						<form ng-submit="request.edit()">
							<div class="row">
								<div class="column">
									<label class="required">
										Request name

										<input type="text" required ng-model="request.formData.name" ng-blur="request.edit()">
									</label>
								</div>
							</div>

							<div class="row">
								<div class="column large-2">
									<label class="required">
										<select required ng-blur="request.edit()" name="input-type"
												  ng-model="request.formData.httpMethod">
											<option>POST</option>
											<option>GET</option>
											<option>PUT</option>
											<option>DELETE</option>
											<option>PATCH</option>
											<option>OPTION</option>
										</select>
									</label>
								</div>

								<div class="column required large-10">
									<input required ng-blur="request.edit()" type="text"
											 ng-model="request.formData.url">
								</div>
							</div>

							<div class="row">
								<div class="column">
									<label>
										Request description
									<textarea rows="3" ng-model="request.formData.description"
												 ng-blur="request.edit()"></textarea>
									</label>
								</div>
							</div>

							<div class="row">
								<div class="column">
									<label>
										API version
										<select ng-show="versions.overview.length > 0"
												  ng-blur="request.edit()"
												  ng-model="request.formData.versionsId"
												  ng-if="request.environment.projectsId"
												  ng-init="versions.init(request.environment.projectsId, request.formData.versionsId)">
											<option ng-repeat="version in versions.overview" value="{{version.id}}">
												{{version.name}}
											</option>
										</select>
									</label>
								</div>
								<div class="column shrink align-bottom">
									<a href="javascript:void(0)" class="button success" data-open="new-version">
										<i class="fi-plus"></i>
									</a>
								</div>

								<div class="column">
									<div class="row">
										<div class="column">
											<label>
												Authentication
												<select ng-show="auths.overview.length > 0"
														  ng-blur="request.edit()"
														  ng-model="request.formData.authenticationsId"
														  ng-if="request.environment.id"
														  ng-init="auths.init(request.environment.id)">
													<option ng-repeat="auth in auths.overview" value="{{auth.id}}">
														{{auth.name}}
													</option>
												</select>
											</label>
										</div>
										<div class="column shrink align-bottom">
											<a href="javascript:void(0)" class="button success"
												data-open="new-authentication">
												<i class="fi-plus"></i>
											</a>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>

					<div class="tabs-panel has-controls" id="request-parameters">
						<h5>{{request.formData.httpMethod}} parameters</h5>

						<div class="content-holder">

							<div class="callout warning" ng-show="emptyObject(request.formData.httpParameters)">Prazdne</div>

							<table ng-show="!emptyObject(request.formData.httpParameters)">
								<tr ng-repeat="param in request.formData.httpParameters">
									<td>{{param.name}}</td>
									<td>{{param.value}}</td>
									<td class="text-right">
										<a href="javascript:void(0)"
											ng-click="request.manageHttpParameters = true; request.httpParametersData = param">
											<i class="fi-pencil"></i>
										</a>
										<a href="javascript:void(0)" ng-click="request.httpParameters.delete(param.id)">
											<i class="fi-x"></i>
										</a>
									</td>
								</tr>
							</table>
						</div>
						<div class="row controls align-right">
							<a href="javascript:void(0)"
								ng-click="request.manageHttpParameters = true; request.httpParametersData = {}"
								class="success tiny button"><i class="fi-plus"></i> <span
									  class="show-for-medium"> Add parameter</span></a>
						</div>
					</div>

					<div class="tabs-panel has-controls" id="headers" ng-controller="HeadersController as headers">
						<h5>Request headers</h5>

						<div class="content-holder">
							<table ng-if="request.environment.id"
									 ng-init="headers.initOverview({projectId: request.environment.projectsId, environmentId: request.environment.id, requestId: request.formData.id})">
								<tr ng-repeat="header in headers.overview">
									<td>{{header.name}}</td>
									<td>{{header.value}}</td>
									<td class="text-right">
								<span ng-show="header.requestsId == request.formData.id">
									<a href="javascript:void(0)"
										ng-click="headers.manageHeaders = true; headers.formData = header">
										<i class="fi-pencil"></i>
									</a>
									<a href="javascript:void(0)" ng-click="headers.delete(header.id)">
										<i class="fi-x"></i>
									</a>
								</span>
									</td>
								</tr>
							</table>
						</div>
						<div class="row controls align-right">
							<a href="javascript:void(0)"
								ng-click="headers.manageHeaders = true; headers.formData= {requestsId: request.formData.id}"
								class="success tiny button">
								<i class="fi-plus"></i>
								<span class="show-for-medium"> Add header</span></a>
						</div>

						<modal show="headers.manageHeaders">
							<h3 ng-show="headers.formData.id">Edit header</h3>
							<h3 ng-show="!headers.formData.id">Create new header</h3>

							<form ng-submit="headers.formData.id ? headers.edit() : headers.create()">
								<div class="row">
									<div class="column">
										<label class="required">
											Name
											<input type="text" required ng-model="headers.formData.name">
										</label>
									</div>
									<div class="column">
										<label>
											Value
											<input type="text" ng-model="headers.formData.value">
										</label>
									</div>
								</div>
								<button type="submit" class="button success">Save</button>
							</form>
						</modal>

					</div>
				</div>
			</div>

			<!--================================-->
			<!--Modal windows-->

			<modal show="versions.manageVersion">
				<h3>New version</h3>

				<form ng-submit="versions.create()">
					<label class="required">
						Name
						<input type="text" required ng-model="versions.formData.name">
					</label>
					<label>
						Description
						<textarea rows="2" ng-model="versions.formData.description"></textarea>
					</label>
					<label>
						URL segment
						<input type="text" ng-model="versions.formData.urlSegment">
					</label>

					<button type="submit" class="button success">Save</button>
				</form>

			</modal>

			<modal show="auths.manageAuth">
				<h3>New authentication</h3>

				<form ng-submit="auths.create()">
					<label class="required">
						Name
						<input type="text" required ng-model="auths.formData.name">
					</label>

					<label class="required">
						Username
						<input type="text" required ng-model="auths.formData.username">
					</label>

					<label class="required">
						Password
						<input type="text" required ng-model="auths.formData.password">
					</label>

					<label class="required">
						Authentication type

						<select required ng-model="auths.formData.type">
							<option value="base">Base Auth</option>
							<option value="bearer">Bearer token</option>
						</select>
					</label>

					<div ng-show="auths.formData.type == 'bearer'">
						<label>
							API method
							<input type="text" ng-model="auths.formData.apiMethod">
						</label>

						<label>
							API parameters (specified as <em>property=value&foo=bar</em>
							<input type="text" ng-model="auths.formData.apiParams">
						</label>

						<label>
							Token property
							<input type="text" ng-model="auths.formData.tokenProperty">
						</label>
					</div>

					<button type="submit" class="button success">Save</button>
				</form>

			</modal>


			<modal show="request.manageHttpParameters">
				<h3 ng-show="request.httpParametersData.id">Edit {{request.formData.httpMethod}} parameter</h3>
				<h3 ng-show="!request.httpParametersData.id">New {{request.formData.httpMethod}} parameter</h3>

				<form ng-submit="request.httpParametersData.id ? request.httpParameters.edit() : request.httpParameters.create()">
					<div class="row">
						<div class="column">
							<label class="required">
								Name
								<input type="text" required ng-model="request.httpParametersData.name">
							</label>
						</div>
						<div class="column">
							<label>
								Value
								<input type="text" ng-model="request.httpParametersData.value">
							</label>
						</div>
					</div>
					<button type="submit" class="button success">Save</button>
				</form>
			</modal>
		</div>
	</div>
</div>